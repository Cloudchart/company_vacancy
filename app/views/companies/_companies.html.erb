<h2><%= t("companies.search.companies", count: collection.size) %></h2>

<ul>
  <% collection.each do |company| %>
    <li>
      <%= link_to display_logo(company), company_path(company) if display_logo(company) %>
      <%= link_to company.name, company_path(company) %>

      <ul>
        <li>
          <strong>Country:</strong>
          <%= Country.all.select { |c| c[1] == company.country }.first[0] %>
        </li>

        <li>
          <strong>Industry:</strong>
          <%= company.industry.name %>
        </li>

        <% if current_user %>

          <li>
            <strong>Relation:</strong>
            <%= calculate_social_relation_for_user(company) %>
          </li>
        
          <% if can?(:update, company) && can?(:destroy, company) %>
            <li>
              <strong>Actions:</strong>
              <%= link_to 'Edit', edit_company_path(company) %>
              <%= link_to 'Destroy', company_path(company), method: :delete, data: { confirm: 'Are you sure?' } %>
            </li>
          <% end %>

          <% if can?(:subscribe, company) && can?(:unsubscribe, company) && !company_owner?(company) %>
            <li>
              <strong>Subscription:</strong>
              <% unless subscribed_to_company?(company) %>
                <%= simple_form_for company.subscriptions.build do |f| %>  
                  <%= f.input :subscribable_id, as: :hidden, input_html: { value: company.id } %>
                  <%= f.input :subscribable_type, as: :hidden, input_html: { value: 'Company' } %>

                  <%= f.simple_fields_for :types do |types| %>
                    <%= types.input :company_info, as: :boolean, checked_value: true, unchecked_value: false %>
                    <%= types.input :vacancies, as: :boolean, checked_value: true, unchecked_value: false %>
                    <%= types.input :events, as: :boolean, checked_value: true, unchecked_value: false %>
                  <% end %>
                  
                  <%= f.submit %>
                <% end %>
<!-- 
                <%= form_tag subscribe_company_path(company) do %>
                  <%= check_box_tag :company_info, true, false, name: 'types[company_info]' %>
                  <%= label_tag :company_info %>

                  <%= check_box_tag :vacancies, true, false, name: 'types[vacancies]' %>
                  <%= label_tag :vacancies %>

                  <%= check_box_tag :events, true, false, name: 'types[events]' %>
                  <%= label_tag :events %>

                  <%= submit_tag 'Subscribe' %>
                <% end %>                
              <% end %> -->

              <%= link_to 'Unsubscribe', unsubscribe_company_path(company) if subscribed_to_company?(company) %>
            </li>
          <% end %>            

        <% end %>

      </ul>
    </li>
  <% end %>  
</ul>
