<h2><%= t("companies.search.companies", count: collection.size) %></h2>

<ul>
  <% collection.each do |company| %>
    <li>
      <%= link_to display_logo(company), company_path(company) if display_logo(company) %>
      <%= link_to company.name, company_path(company) %>

      <ul>
        <li>
          <strong>Country:</strong>
          <%= Country.all.select { |c| c[1] == company.country }.first[0] %>
        </li>

        <li>
          <strong>Industry:</strong>
          <%= company.industry.name %>
        </li>

        <% if current_user %>

          <li>
            <strong>Relation:</strong>
            <%= calculate_social_relation_for_user(company) %>
          </li>
        
          <% if can?(:update, company) && can?(:destroy, company) %>
            <li>
              <strong>Actions:</strong>
              <%= link_to 'Edit', edit_company_path(company) %>
              <%= link_to 'Destroy', company_path(company), method: :delete, data: { confirm: 'Are you sure?' } %>
            </li>
          <% end %>

          <% if can?(:manage, Subscription) && !company_owner?(company) %>
            <li>
              <strong>Subscription:</strong>
              <% unless subscribed_to_company?(company) %>

                <%= simple_form_for company.subscriptions.build do |f| %>  
                  <%= f.input :subscribable_id, as: :hidden %>
                  <%= f.input :subscribable_type, as: :hidden %>

                  <%= f.simple_fields_for :types do |type| %>
                    <%= type.input :company_page, as: :boolean %>
                    <%= type.input :vacancies, as: :boolean %>
                    <%= type.input :events, as: :boolean %>
                  <% end %>

                  <%= f.submit %>
                <% end %>

              <% end %>

              <%= link_to 'Unsubscribe', subscription_path(company.id), method: :delete, data: { confirm: 'Are you sure?' } if subscribed_to_company?(company) %>

            </li>
          <% end %>            

        <% end %>

      </ul>
    </li>
  <% end %>  
</ul>
