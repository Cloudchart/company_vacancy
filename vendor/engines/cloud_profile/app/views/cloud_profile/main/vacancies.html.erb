<%- class_for_main 'cloud-profile' -%>

<div class="vacancies-wrapper">

  <h1>
    <%= link_to font_awesome('angle-left'), cloud_profile.root_path %>
    <%= t '.vacancies', default: 'Vacancies' %>
  </h1>

  <% @companies.each do |company| %>

    <div id="<%= company.id %>" class="company">
      <header>
        <ul>
          <li>
            <span class="favorites-link">
              <%= render 'shared/favorites_link', object: company %>
            </span>

            <%= company.name %>
          </li>

          <li class="opened">
            0 opened vacancies
          </li>

          <li class="in-review">
            0 in review
          </li>

          <li class="closed">
            0 closed
          </li>

          <li>
            <%= render 'shared/add_item', path: main_app.new_company_vacancy_path(company) %>
          </li>
        </ul>  
      </header>

      <div class="vacancies">
        <% company.vacancies.each do |vacancy| %>
          <ul>
            <li class="name">
              <%= vacancy.name %>
            </li>

            <li class="status">
              <%= vacancy.status %>
            </li>

            <li class="actions">
              <% if can?(:change_status, vacancy) %>
                <% if vacancy.status == 'draft' %>
                  <%= link_to 'Publish', main_app.change_status_vacancy_path(vacancy, :opened), method: :patch %>
                <% elsif vacancy.status == 'opened' %>
                  <%= link_to 'Close', main_app.change_status_vacancy_path(vacancy, :closed), method: :patch %>
                <% end %>
              <% end %>

              <%= link_to 'Destroy', main_app.vacancy_path(vacancy), method: :delete, data: { confirm: 'Are you sure?' } if can?(:destroy, vacancy) %>
            </li>
          </ul>

        <% end %>
      </div>

    </div>
    
  <% end %>
  
</div>
