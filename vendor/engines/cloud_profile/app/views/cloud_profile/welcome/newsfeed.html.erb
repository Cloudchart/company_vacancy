<%- class_for_main 'cloud-profile' -%>

<%- cloud_profile_nav_current_tab :newsfeed -%>
<%= render partial: 'shared/nav' %>

<table>
  <thead>
    <tr>
      <th>Object</th>
      <th>Event</th>
      <th>Changes made</th>
      <th>Changed on</th>
    </tr>
  </thead>

  <tbody>
    <% @versions.each do |version| %>
      <tr>
        <td>
          <% controller = "#{version.item.class.name.pluralize}Controller".constantize rescue false %>
          <% if version.try(:item) && controller && controller.action_methods.include?('show') %>
            <%= link_to version.item_type, main_app.send("#{version.item.class.name.underscore}_path", version.item), target: '_blank' %>
          <% else %>
            <%= version.item_type %>
          <% end %>
        </td>

        <td>
          <%= version.event %>
        </td>

        <td style="border: 1px dotted black;">
          <%= version.changeset.map { |k,v| "#{k} = #{v[1]}" }.join(', ') if version.event == 'update' %>
        </td>

        <td>
          <%= version.created_at %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
